{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">Printing Neatly (Text Justification)</h2>
    
    <!-- Input Section -->
    <div class="card mb-4">
        <div class="card-body">
            <div class="row g-3 align-items-end">
                <div class="col-md-6">
                    <label for="inputText" class="form-label">輸入文字 (以空白分隔):</label>
                    <textarea class="form-control" id="inputText" rows="2">This is a sample text for printing neatly problem visualization</textarea>
                </div>
                <div class="col-md-2">
                    <label for="inputM" class="form-label">行寬 (M):</label>
                    <input type="number" class="form-control" id="inputM" value="20">
                </div>
                <div class="col-md-4">
                    <button class="btn btn-primary me-2" id="startBtn">開始計算</button>
                    <button class="btn btn-secondary me-2" id="prevBtn" disabled>上一步</button>
                    <button class="btn btn-secondary me-2" id="nextBtn" disabled>下一步</button>
                    <button class="btn btn-success me-2" id="autoBtn" disabled>自動播放</button>
                    <button class="btn btn-danger" id="resetBtn">重置</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Visualization & Explanation -->
    <div class="row">
        <!-- Left: Visualization -->
        <div class="col-md-7">
            <div class="card mb-4">
                <div class="card-header">排版視覺化</div>
                <div class="card-body text-center">
                    <div id="visualization-container" style="min-height: 300px; border: 1px solid #eee; padding: 20px; text-align: left; font-family: monospace; font-size: 16px;">
                        <!-- Lines will be rendered here -->
                    </div>
                </div>
            </div>
            
            <!-- DP Table Visualization -->
            <div class="card">
                <div class="card-header">DP 狀態 (Cost Array)</div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-bordered table-sm text-center" id="dpTable">
                            <thead>
                                <tr id="dpHeader">
                                    <!-- Headers generated by JS -->
                                </tr>
                            </thead>
                            <tbody>
                                <tr id="dpRow">
                                    <!-- Values generated by JS -->
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right: Explanation -->
        <div class="col-md-5">
            <div class="card mb-3">
                <div class="card-header bg-info text-white">
                    <i class="fas fa-info-circle"></i> 演算法說明
                </div>
                <div class="card-body">
                    <div class="alert alert-primary" role="alert" id="step-explanation">
                        請輸入文字並設定行寬，點擊「開始計算」。
                    </div>
                    
                    <div class="mt-3">
                        <h5>定義:</h5>
                        <ul>
                            <li>$M$: 每行的最大寬度。</li>
                            <li>$l_i$: 第 $i$ 個單字的長度。</li>
                            <li>$extras[i, j] = M - j + i - \sum_{k=i}^j l_k$: 若將單字 $i$ 到 $j$ 放在同一行，剩餘的空白數。</li>
                            <li>$lc[i, j]$: 行成本 (Line Cost)。
                                <ul>
                                    <li>若 $extras[i, j] < 0$, $lc[i, j] = \infty$ (放不下)</li>
                                    <li>若 $j=n$ (最後一行) 且 $extras[i, j] \ge 0$, $lc[i, j] = 0$</li>
                                    <li>否則 $lc[i, j] = (extras[i, j])^3$</li>
                                </ul>
                            </li>
                        </ul>
                        
                        <h5>遞迴式 (DP):</h5>
                        <p>
                            $$c[j] = \min_{1 \le i \le j} (c[i-1] + lc[i, j])$$
                        </p>
                        <p>
                            $c[j]$ 代表排列前 $j$ 個單字的最小總成本。
                        </p>
                    </div>
                    
                    <button class="btn btn-outline-secondary btn-sm mt-2" data-bs-toggle="modal" data-bs-target="#fullExplanationModal">
                        查看完整說明與虛擬碼
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Full Explanation Modal -->
<div class="modal fade" id="fullExplanationModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Printing Neatly - 完整說明</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <h4>問題描述</h4>
                <p>給定一連串單字與最大行寬 $M$，我們希望將單字排版，使得除了最後一行以外，每一行行尾的空白數立方和最小。</p>
                
                <h4>核心觀念</h4>
                <p>這是一個動態規劃問題。我們定義 $c[j]$ 為「最佳排列前 $j$ 個單字的最小成本」。</p>
                <p>為了計算 $c[j]$，我們考慮最後一行可能的組成。最後一行可能包含單字 $i$ 到 $j$ (其中 $1 \le i \le j$)。</p>
                <p>如果最後一行是單字 $i \dots j$，那麼前 $i-1$ 個單字必須已經被最佳排列。因此成本為：</p>
                <p>$$Cost = c[i-1] + lc[i, j]$$</p>
                <p>我們遍歷所有可能的 $i$，找出最小值。</p>

                <hr>
                <h4>虛擬碼 (Pseudocode)</h4>
                <pre class="bg-light p-3 border rounded">
PRINT-NEATLY(l, n, M)
    // Compute extras[i, j]
    for i = 1 to n
        extras[i, i] = M - l[i]
        for j = i + 1 to n
            extras[i, j] = extras[i, j-1] - l[j] - 1
    
    // Compute lc[i, j]
    for i = 1 to n
        for j = i to n
            if extras[i, j] < 0
                lc[i, j] = ∞
            else if j == n and extras[i, j] >= 0
                lc[i, j] = 0
            else
                lc[i, j] = (extras[i, j])^3
                
    // Compute c[j] and p[j]
    c[0] = 0
    for j = 1 to n
        c[j] = ∞
        for i = 1 to j
            if c[i-1] != ∞ and lc[i, j] != ∞
                if c[i-1] + lc[i, j] < c[j]
                    c[j] = c[i-1] + lc[i, j]
                    p[j] = i
    return c, p
                </pre>
            </div>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/printing_neatly.js') }}"></script>
{% endblock %}
