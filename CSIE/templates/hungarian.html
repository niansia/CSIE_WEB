{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">Hungarian Algorithm (匈牙利演算法)</h2>
    
    <div class="row">
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">設定 (Configuration)</h5>
                    <div class="mb-3">
                        <label for="matrix-size" class="form-label">矩陣大小 (Size): <span id="size-display">4x4</span></label>
                        <input type="range" class="form-range" id="matrix-size" min="3" max="6" value="4">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">問題類型 (Problem Type):</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="problemType" id="typeMin" value="min" checked>
                            <label class="form-check-label" for="typeMin">
                                最小化成本 (Minimization)
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="problemType" id="typeMax" value="max">
                            <label class="form-check-label" for="typeMax">
                                最大化效益 (Maximization)
                            </label>
                        </div>
                    </div>
                    
                    <h6>成本矩陣 (Cost Matrix)</h6>
                    <div id="input-grid" class="mb-3">
                        <!-- Generated by JS -->
                    </div>
                    
                    <button class="btn btn-warning w-100 mb-2" id="btn-random">隨機產生 (Random)</button>
                    <button class="btn btn-success w-100 mb-2" id="btn-solve">開始計算 (Solve)</button>
                    <button class="btn btn-info w-100 mb-2" data-bs-toggle="modal" data-bs-target="#helpModal">說明 (Help)</button>
                    
                    <hr>
                    
                    <div class="btn-group w-100" role="group">
                        <button type="button" class="btn btn-secondary" id="btn-prev">上一步 (Prev)</button>
                        <button type="button" class="btn btn-secondary" id="btn-play">播放 (Play)</button>
                        <button type="button" class="btn btn-secondary" id="btn-next">下一步 (Next)</button>
                    </div>
                    
                    <div class="mt-3">
                        <label>速度 (Speed): <span id="speedDisplay">2100 ms</span></label>
                        <input type="range" class="form-range" id="speed" min="100" max="5000" value="3000">
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-8">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">視覺化 (Visualization)</h5>
                    <p id="status-text" class="text-primary" style="min-height: 3em;">準備就緒 (Ready).</p>
                    
                    <div class="position-relative d-flex justify-content-center align-items-center" style="min-height: 400px; background-color: #f8f9fa; border: 1px solid #dee2e6;">
                        <div id="viz-container" class="position-relative">
                            <!-- Grid and Canvas will be here -->
                            <div id="viz-grid" style="display: grid; gap: 5px;"></div>
                            <canvas id="viz-canvas" style="position: absolute; top: 0; left: 0; pointer-events: none;"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Help Modal -->
    <div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="helpModalLabel">Hungarian Algorithm 說明</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h5>最小成本指派問題 (Minimum Cost Assignment Problem)</h5>
                    <p>使用匈牙利演算法 (Hungarian Algorithm) 解決。</p>
                    <p><strong>最大化問題 (Maximization Problem)：</strong></p>
                    <p>若選擇最大化，步驟 0 會先將矩陣轉換為最小化問題：找出矩陣中最大值 M，將所有元素改為 M - 元素值。</p>
                    <p><strong>步驟：</strong></p>
                    <ol>
                        <li><strong>列減法 (Row Reduction):</strong> 每列減去該列的最小值。</li>
                        <li><strong>覆蓋檢查 (Covering):</strong> 計算覆蓋所有 0 所需的最少直線數。若直線數 = N，則跳至步驟 6。</li>
                        <li><strong>行減法 (Column Reduction):</strong> 每行減去該行的最小值。</li>
                        <li><strong>覆蓋檢查 (Covering):</strong> 再次計算覆蓋所有 0 所需的最少直線數。若直線數 = N，則跳至步驟 6。</li>
                        <li><strong>擴充 (Augment):</strong> 
                            <ul>
                                <li>找出所有「未被覆蓋」元素中的最小值 (min)。</li>
                                <li>所有「未被覆蓋」的元素減去 min。</li>
                                <li>所有「被兩條線覆蓋」(交叉點) 的元素加上 min。</li>
                                <li>回到步驟 4 繼續檢查。</li>
                            </ul>
                        </li>
                        <li><strong>指派 (Assignment):</strong> 根據 0 的位置進行最佳指派。</li>
                    </ol>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .hungarian-input {
        width: 100%;
        text-align: center;
        padding: 5px;
    }
    .viz-cell {
        width: 60px;
        height: 60px;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: white;
        border: 1px solid #ccc;
        font-size: 1.2em;
        font-weight: bold;
        position: relative;
        transition: background-color 0.3s;
    }
    .viz-cell.highlight-sub {
        background-color: #ffcdd2; /* Red tint for subtraction */
    }
    .viz-cell.highlight-add {
        background-color: #c8e6c9; /* Green tint for addition */
    }
    .viz-cell.assigned {
        background-color: #4caf50;
        color: white;
        border-radius: 50%;
    }
    .viz-cell.covered {
        opacity: 0.7;
    }
</style>

<script src="{{ url_for('static', filename='js/hungarian.js') }}"></script>
{% endblock %}
