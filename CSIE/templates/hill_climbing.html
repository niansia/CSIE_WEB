{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">Hill Climbing Algorithm (登山搜尋演算法)</h2>
    
    <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="simple-tab" data-bs-toggle="tab" data-bs-target="#simple" type="button" role="tab" aria-controls="simple" aria-selected="true">普通圖形搜尋 (Simple Graph)</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="puzzle-tab" data-bs-toggle="tab" data-bs-target="#puzzle" type="button" role="tab" aria-controls="puzzle" aria-selected="false">8拼圖問題 (8-Puzzle)</button>
        </li>
    </ul>
    
    <div class="tab-content" id="myTabContent">
        <!-- Simple Graph Tab -->
        <div class="tab-pane fade show active" id="simple" role="tabpanel" aria-labelledby="simple-tab">
            <div class="row mt-3">
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">控制面板 (Controls)</h5>
                            <button class="btn btn-primary w-100 mb-2" id="btn-gen-graph">產生隨機圖形 (Generate Random Graph)</button>
                            <button class="btn btn-success w-100 mb-2" id="btn-solve-simple">開始搜尋 (Start Search)</button>
                            <button class="btn btn-warning w-100 mb-2" data-bs-toggle="modal" data-bs-target="#helpModal">說明 (Help)</button>
                            <hr>
                            <div class="btn-group w-100" role="group">
                                <button type="button" class="btn btn-secondary" id="btn-prev-simple">上一步 (Prev)</button>
                                <button type="button" class="btn btn-secondary" id="btn-play-simple">播放 (Play)</button>
                                <button type="button" class="btn btn-secondary" id="btn-next-simple">下一步 (Next)</button>
                            </div>
                            <div class="mt-3">
                                <label>速度 (Speed): <span id="speedDisplay-simple">2100 ms</span></label>
                                <input type="range" class="form-range" id="speed-simple" min="100" max="5000" value="3000">
                            </div>
                        </div>
                    </div>
                    <div class="card mt-3">
                        <div class="card-body">
                            <h5 class="card-title">堆疊 (Stack)</h5>
                            <ul class="list-group" id="stack-list-simple" style="max-height: 300px; overflow-y: auto;">
                                <!-- Stack items -->
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-md-9">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">視覺化 (Visualization)</h5>
                            <p id="status-simple" class="text-info">準備就緒 (Ready).</p>
                            <canvas id="canvas-simple" width="800" height="500" style="border: 1px solid #ccc;"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 8-Puzzle Tab -->
        <div class="tab-pane fade" id="puzzle" role="tabpanel" aria-labelledby="puzzle-tab">
            <div class="row mt-3">
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">設定 (Configuration)</h5>
                            <div class="row">
                                <div class="col-6">
                                    <h6>起始狀態 (Start State)</h6>
                                    <div id="start-grid" class="puzzle-input-grid">
                                        <!-- Generated by JS -->
                                    </div>
                                </div>
                                <div class="col-6">
                                    <h6>目標狀態 (Goal State)</h6>
                                    <div id="goal-grid" class="puzzle-input-grid">
                                        <!-- Generated by JS -->
                                    </div>
                                </div>
                            </div>
                            <button class="btn btn-warning w-100 mt-3 mb-2" id="btn-random-puzzle">隨機起始狀態 (Randomize Start)</button>
                            <button class="btn btn-success w-100 mb-2" id="btn-solve-puzzle">開始搜尋 (Start Search)</button>
                            <button class="btn btn-warning w-100 mb-2" data-bs-toggle="modal" data-bs-target="#helpModal">說明 (Help)</button>
                            <hr>
                            <div class="btn-group w-100" role="group">
                                <button type="button" class="btn btn-secondary" id="btn-prev-puzzle">上一步 (Prev)</button>
                                <button type="button" class="btn btn-secondary" id="btn-play-puzzle">播放 (Play)</button>
                                <button type="button" class="btn btn-secondary" id="btn-next-puzzle">下一步 (Next)</button>
                            </div>
                            <div class="mt-3">
                                <label>速度 (Speed): <span id="speedDisplay-puzzle">2100 ms</span></label>
                                <input type="range" class="form-range" id="speed-puzzle" min="100" max="5000" value="3000">
                            </div>
                        </div>
                    </div>
                    <div class="card mt-3">
                        <div class="card-body">
                            <h5 class="card-title">堆疊 (Stack)</h5>
                            <ul class="list-group" id="stack-list-puzzle" style="max-height: 300px; overflow-y: auto;">
                                <!-- Stack items -->
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">搜尋樹視覺化 (Search Tree Visualization)</h5>
                            <p id="status-puzzle" class="text-info">準備就緒 (Ready).</p>
                            <div style="overflow: auto; height: 600px;">
                                <canvas id="canvas-puzzle" width="1200" height="800" style="border: 1px solid #ccc;"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Help Modal -->
    <div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="helpModalLabel">Algorithm Description</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h5>Hill Climbing Algorithm (登山搜尋演算法)</h5>
                    <p><strong>Input:</strong> 起始狀態(或起始節點)與目標狀態(或目標節點)</p>
                    <p><strong>Output:</strong> 目標狀態(或目標節點)對應的解答</p>
                    <ol>
                        <li>設定起始節點為解答空間樹的根節點，標示根節點，並建立一個只包含啟始節點的堆疊(stack)。</li>
                        <li>拜訪並檢查堆疊頂端的元素(節點)是否為目標節點(goal node)。若是，則輸出目標節點所對應的解答並停止。</li>
                        <li>移除堆疊頂端的節點。若此節點可以擴展(expand)出未標示過的子節點，則標示這些節點，並根據由評估函數所計算的優先順序將其一一加入堆疊的頂端，優先順序低的先加入。</li>
                        <li>若堆疊為空，則回報無解答並停止。否則，跳至步驟2繼續執行。</li>
                    </ol>
                    <hr>
                    <h5>8-Puzzle Problem (8拼圖問題)</h5>
                    <p><strong>目標：</strong> 將盤面上的數字滑動，使其與目標狀態完全一致。</p>
                    <p><strong>評估函數 \(h(n)\) (Heuristic Function)：</strong></p>
                    <p>我們使用 <strong>Misplaced Tiles (錯位方塊數)</strong>。</p>
                    <p>計算方式：計算盤面上每一個數字 (不含空格 0) 是否在正確的目標位置上。若位置不同，則計數加 1。</p>
                    <p>\[ h(n) = \text{count of tiles where } position(tile) \neq goal\_position(tile) \]</p>
                    <p><strong>範例：</strong></p>
                    <p>假設目標是：<br>
                    1 2 3<br>
                    4 5 6<br>
                    7 8 0</p>
                    <p>當前狀態中，若數字 <strong>1, 2, 3</strong> 位置正確，但 <strong>4, 5</strong> 位置互換，且其他位置正確。<br>
                    則數字 4 位置不對，數字 5 位置不對。共 2 個錯位。</p>
                    <p>故 \(h = 2\)。\(h\) 值越小，代表越接近目標。</p>
                    <p>優先順序較高 (距離較小) 的節點會被放在堆疊頂端，優先被拜訪。</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .puzzle-input-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 5px;
        max-width: 150px;
        margin: 0 auto;
    }
    .puzzle-input-grid input {
        width: 100%;
        text-align: center;
    }
</style>

<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script>
  window.MathJax = {
    options: {
      enableMenu: false
    },
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']]
    }
  };
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="{{ url_for('static', filename='js/hill_climbing.js') }}"></script>
{% endblock %}
